<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Qu·∫£n L√Ω Cafe</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="employees.css">
    

</head>
<body>
</head>
<body>
    <div id="app">
        <!-- Header v·ªõi tabs -->
        <header class="header">
            <div class="user-info">
                <button class="tab-btn active" data-tab="reports" title="B√°o c√°o">üìà</button>
                <button class="tab-btn" data-tab="inventory" title="Kho">üì¶</button>
                <button class="tab-btn" data-tab="statistics" title="Th·ªëng k√™">üìä</button> <!-- Th√™m tab n√†y -->
                
                    <button class="tab-btn" data-tab="employees" title="Nh√¢n vi√™n">üë•</button>
                    <button class="tab-btn" data-tab="overview" title="T·ªïng quan">üëÅ</button>
                
            </div>
        </header>
    <div id="app">
        <!-- Header s·∫Ω ƒë∆∞·ª£c render b·∫±ng JavaScript -->
        <header id="appHeader" class="header">
            <!-- N·ªôi dung t·∫°m th·ªùi -->
            <div class="loading-header">ƒêang t·∫£i...</div>
        </header>

        <!-- N·ªôi dung ch√≠nh -->
        <main class="main-content">
            <!-- Tab B√°o c√°o -->
            <div id="reports" class="tab-content active"></div>

            <!-- Tab Kho -->
            <div id="inventory" class="tab-content"></div>

            <!-- Tab Th·ªëng k√™ -->
            <div id="statistics" class="tab-content"></div>

            <!-- Tab Nh√¢n vi√™n (Admin only - JS s·∫Ω ·∫©n/hi·ªán) -->
            <!-- Tab Nh√¢n vi√™n -->
            <div id="employees" class="tab-content"></div>

            <!-- Tab T·ªïng quan (Admin only - JS s·∫Ω ·∫©n/hi·ªán) -->
            <div id="overview" class="tab-content"></div>
        </main>

        <!-- Popup container -->
        <div id="popupContainer" class="popup-container"></div>

        <!-- Loading overlay -->
        <div id="loadingOverlay" class="loading-overlay">
            <div class="loading-spinner">ƒêang t·∫£i...</div>
        </div>
    </div>

    <!-- ========================= -->
    <!-- Firebase SDK              -->
    <!-- ========================= -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    
    <script>
        // Kh·ªüi t·∫°o Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAcYhLhEiJk0WjQvQdwk0oNgyotp-ewKsk",
            authDomain: "milano259.firebaseapp.com",
            projectId: "milano259",
            storageBucket: "milano259.firebasestorage.app",
            messagingSenderId: "681812166818",
            appId: "1:681812166818:web:24e638784a239b0021effb",
            measurementId: "G-FSL6MSC7CT",
            databaseURL: "https://milano259-default-rtdb.asia-southeast1.firebasedatabase.app"
        };

        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
            console.log('‚úÖ Firebase initialized');
        }
    </script>

    <!-- ========================= -->
    <!-- Core scripts              -->
    <!-- ========================= -->
    <script src="database.js"></script>
    <script src="auth.js"></script>
    
    <!-- ========================= -->
    <!-- Feature scripts           -->
    <!-- ========================= -->
    <script src="reports.js"></script>
    <script src="employees.js"></script>
    <script src="inventory.js"></script>
    <script src="statistics.js"></script>
    <script src="overview.js"></script>
    <script src="app.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                console.log('üöÄ Starting app initialization...');
                
                // 1. Kh·ªüi t·∫°o database
                await initializeDatabase();
                console.log('‚úÖ Database initialized');
                
                // 2. Ki·ªÉm tra ƒëƒÉng nh·∫≠p
                const user = getCurrentUser();
                if (!user) {
                    console.log('‚ö†Ô∏è User not logged in, redirecting...');
                    window.location.href = 'login.html';
                    return;
                }
                
                console.log('‚úÖ User logged in:', user.name, '- Role:', user.role);
                
                // 3. Render header
                
                
                // 4. ·∫®n loading
                const loading = document.getElementById('loadingOverlay');
                if (loading) {
                    setTimeout(() => {
                        loading.style.display = 'none';
                    }, 500);
                }
                
                // 5. Load tab ƒë·∫ßu ti√™n
                loadTabContent('reports');
                
            } catch (error) {
                console.error('‚ùå App initialization error:', error);
                showErrorMessage(error);
            }
        });

        

        // H√†m load n·ªôi dung tab
        function loadTabContent(tabId) {
            console.log(`üìÇ Loading tab: ${tabId}`);
            
            // Hi·ªÉn th·ªã tab content
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => {
                content.classList.remove('active');
                if (content.id === tabId) {
                    content.classList.add('active');
                }
            });
            
            // Hi·ªÉn th·ªã loading
            const tabContent = document.getElementById(tabId);
            if (tabContent) {
                tabContent.innerHTML = '<div class="tab-loading">ƒêang t·∫£i...</div>';
            }
            
            // G·ªçi h√†m load t∆∞∆°ng ·ª©ng
            setTimeout(() => {
                switch(tabId) {
                    case 'reports':
                        if (typeof loadReports === 'function') {
                            loadReports();
                        } else {
                            console.warn('‚ö†Ô∏è loadReports function not found');
                            tabContent.innerHTML = '<div class="tab-error">Kh√¥ng th·ªÉ t·∫£i b√°o c√°o</div>';
                        }
                        break;
                        
                    case 'inventory':
                        if (typeof loadInventory === 'function') {
                            loadInventory();
                        } else {
                            console.warn('‚ö†Ô∏è loadInventory function not found');
                            tabContent.innerHTML = '<div class="tab-error">Kh√¥ng th·ªÉ t·∫£i kho</div>';
                        }
                        break;
                        
                    case 'statistics':
                        if (typeof loadStatistics === 'function') {
                            loadStatistics();
                        } else {
                            console.warn('‚ö†Ô∏è loadStatistics function not found');
                            tabContent.innerHTML = '<div class="tab-error">Kh√¥ng th·ªÉ t·∫£i th·ªëng k√™</div>';
                        }
                        break;
                        
                    case 'employees':
                        if (typeof loadEmployeesData === 'function') {
                            loadEmployeesData();
                        } else {
                            console.warn('‚ö†Ô∏è loadEmployeesData function not found');
                            tabContent.innerHTML = '<div class="tab-error">Kh√¥ng th·ªÉ t·∫£i nh√¢n vi√™n</div>';
                        }
                        break;
                        
                    case 'overview':
                        if (typeof loadOverview === 'function') {
                            loadOverview();
                        } else {
                            console.warn('‚ö†Ô∏è loadOverview function not found');
                            tabContent.innerHTML = '<div class="tab-error">Kh√¥ng th·ªÉ t·∫£i t·ªïng quan</div>';
                        }
                        break;
                        
                    default:
                        console.warn(`‚ö†Ô∏è Unknown tab: ${tabId}`);
                        if (tabContent) {
                            tabContent.innerHTML = `<div class="tab-error">Tab ${tabId} kh√¥ng t·ªìn t·∫°i</div>`;
                        }
                }
            }, 100);
        }

        // H√†m hi·ªÉn th·ªã l·ªói
        function showErrorMessage(error) {
            const loading = document.getElementById('loadingOverlay');
            if (loading) {
                loading.innerHTML = `
                    <div class="error-message">
                        <h3>‚ö†Ô∏è L·ªói kh·ªüi t·∫°o ·ª©ng d·ª•ng</h3>
                        <p>${error.message || 'Vui l√≤ng t·∫£i l·∫°i trang'}</p>
                        <button onclick="location.reload()" class="reload-btn">
                            T·∫£i l·∫°i trang
                        </button>
                    </div>
                `;
            }
        }
        // C√°ch g·ªçi ƒë√∫ng
document.addEventListener('DOMContentLoaded', function() {
    // Ki·ªÉm tra xem module ƒë√£ load ch∆∞a
    if (typeof window.loadEmployeesData === 'function') {
        window.loadEmployeesData();
    } else {
        console.error('Employees module not loaded. Check script order.');
        // Load file 2 n·∫øu ch∆∞a
        loadScript('employees.js', function() {
            if (typeof window.loadEmployeesData === 'function') {
                window.loadEmployeesData();
            }
        });
    }
});

function loadScript(src, callback) {
    const script = document.createElement('script');
    script.src = src;
    script.onload = callback;
    document.head.appendChild(script);
}
    </script>
</body>
</html>